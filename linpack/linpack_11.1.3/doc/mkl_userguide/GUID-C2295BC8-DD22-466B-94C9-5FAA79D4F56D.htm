<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- saved from url=(0014)about:internet -->
<html xmlns:MSHelp="http://www.microsoft.com/MSHelp/" lang="en-us" xml:lang="en-us"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<meta name="DC.Type" content="topic">
<meta name="DC.Title" content="Avoiding Conflicts in the Execution Environment">
<meta name="DC.subject" content="parallel performance">
<meta name="keywords" content="parallel performance">
<meta name="DC.Relation" scheme="URI" content="GUID-A09C5398-D263-42F8-95E2-772C3C1FE79C.htm">
<meta name="DC.Relation" scheme="URI" content="GUID-0073DDBD-3239-44B2-AD92-87A533733E11.htm">
<meta name="DC.Relation" scheme="URI" content="GUID-01E66248-FBD1-49E9-8EFF-40AE61A81C57.htm">
<meta name="DC.Relation" scheme="URI" content="http://www.intel.com/software/products/softwaredocs_feedback">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="GUID-C2295BC8-DD22-466B-94C9-5FAA79D4F56D">
<meta name="DC.Language" content="en-US">
<link rel="stylesheet" type="text/css" href="intel_css_styles.css">
<title>Avoiding Conflicts in the Execution Environment</title>
<xml>
<MSHelp:Attr Name="DocSet" Value="Intel"></MSHelp:Attr>
<MSHelp:Attr Name="Locale" Value="kbEnglish"></MSHelp:Attr>
<MSHelp:Attr Name="TopicType" Value="kbReference"></MSHelp:Attr>
<MSHelp:Keyword Index="F" Term="mkl_set_num_threads_local"></MSHelp:Keyword>
<MSHelp:Keyword Index="F" Term="intel.cpp.mkl_set_num_threads_local"></MSHelp:Keyword>
<MSHelp:Keyword Index="F" Term="intel.for.mkl_set_num_threads_local"></MSHelp:Keyword>
</xml>
</head>
<body id="GUID-C2295BC8-DD22-466B-94C9-5FAA79D4F56D">
 <!-- ==============(Start:NavScript)================= -->
 <script src="NavScript.js" language="JavaScript1.2" type="text/javascript"></script>
 <script language="JavaScript1.2" type="text/javascript">WriteNavLink(0);</script>
 <!-- ==============(End:NavScript)================= -->
<p id="header_text" style="margin-bottom : 20pt"><em>Intel&reg; Math Kernel Library 11.1 Update 3 User's Guide</em></p>


 
  <h1 class="topictitle1">Avoiding Conflicts in the Execution Environment</h1>
 
   
  <div id="GUID-DF1D2533-873D-4E94-8C1A-BD7C5331B80C"> 
	 <p id="GUID-6069F6D0-8135-4EE1-8F95-080E7D80DAA4">Certain situations can cause conflicts in the execution environment that make the use of threads in Intel MKL problematic. This section briefly discusses why these problems exist and how to avoid them. 
	 </p>
 
	 <p id="GUID-1AF250DB-D966-4E74-8FDD-456B6737BC0B">If you thread the program using OpenMP directives and compile the program with Intel compilers, Intel MKL and the program will both use the same threading library. Intel MKL tries to determine if it is in a parallel region in the program, and if it is, it does not spread its operations over multiple threads unless you specifically request Intel MKL to do so via the 
		<samp class="codeph" id="GUID-69C1CFF1-9E29-4660-82D6-A4C3F692DBCE">MKL_DYNAMIC</samp> functionality. However, Intel MKL can be aware that it is in a parallel region only if the threaded program and Intel MKL are using the same threading library. If your program is threaded by some other means, Intel MKL may operate in multithreaded mode, and the performance may suffer due to overuse of the resources. 
	 </p>
 
	 <p id="GUID-3109B4BA-2A29-4B69-9E56-47A18BF93D52">The following table considers several cases where the conflicts may arise and provides recommendations depending on your threading model: 
	 </p>
 
	 
<div class="tablenoborder"><table cellpadding="4" summary="" id="GUID-51FE8B86-A4CF-4263-9868-48E8CE788F37" width="100%" frame="hsides" border="1" rules="all"> 
		   
		   
		  <thead align="left"> 
			 <tr> 
				<th class="cellrowborder" valign="top" width="30%" id="d66342e62"> 
				  <p id="GUID-E6A3C220-D09E-4751-BF28-D93A15DAAAA8">Threading model 
				  </p>
 
				</th>
 
				<th class="row-nocellborder" valign="top" width="70%" id="d66342e68"> 
				  <p id="GUID-0EB93DF8-C4D9-42B1-84ED-534315462EC3">Discussion 
				  </p>
 
				</th>
 
			 </tr>
 
		  </thead>
 
		  <tbody> 
			 <tr> 
				<td class="cellrowborder" valign="top" width="30%" headers="d66342e62 "> 
				  <p id="GUID-C8C19D63-3807-4382-9F6D-C00DAF24C22D">You thread the program using OS threads (<samp class="codeph" id="GUID-555843A2-83A7-4EDF-B1DE-BF396E8C2FF0">pthreads</samp> on 
					 Linux* OS). 
				  </p>
 
				</td>
 
				<td class="row-nocellborder" valign="top" width="70%" headers="d66342e68 "> 
				  <p id="GUID-F08B103F-75A1-455C-A5C2-1F7EC0F929D9">If more than one thread calls Intel MKL, and the function being called is threaded, it may be important that you turn off Intel MKL threading. Set the number of threads to one by any of the available means (see 
					 <a href="GUID-DEEF0363-2B34-4BAB-87FA-A75DBE842040.htm">Techniques to Set the Number of Threads</a>). 
				  </p>
 
				</td>
 
			 </tr>
 
			 <tr> 
				<td class="cellrowborder" valign="top" width="30%" headers="d66342e62 "> 
				  <p id="GUID-A2831981-B130-4590-8C3D-17B94D51B890">You thread the program using OpenMP directives and/or pragmas and compile the program using a compiler other than a compiler from Intel. 
				  </p>
 
				</td>
 
				<td class="row-nocellborder" valign="top" width="70%" headers="d66342e68 "> 
				  <p id="GUID-4DDB9BB9-8BC3-4080-85C6-9311FE6CA4A9">This is more problematic because setting of the 
					 <samp class="codeph" id="GUID-71EB630F-269E-4E90-8647-118CE70684C0">OMP_NUM_THREADS</samp> environment variable affects both the compiler's threading library and 
					 <samp class="codeph" id="GUID-A63F6D05-5CA0-4C67-8264-714E98A744FB">libiomp5</samp>. In this case, choose the threading library that matches the layered Intel MKL with the OpenMP compiler you employ (see 
					 <span id="GUID-45175271-2820-44FF-B2F9-5B527958D08D"><a href="GUID-C676FE09-339D-4147-BB79-4038A27A6851.htm">Linking Examples</a></span> on how to do this). If this is not possible, use Intel MKL in the sequential mode. To do this, you should link with the appropriate threading library: 
					 <span class="filepath" id="GUID-5F2C6789-D090-4ED1-B507-5319E9FF24E0">lib</span><span class="filepath" id="GUID-CC6B2E91-58D0-4918-99D0-533BCA0462EC">mkl_sequential.</span><span class="filepath" id="GUID-35DB5B15-0664-43F8-840E-952294DB9021">a</span> or 
					 <span class="filepath" id="GUID-677B4B94-301E-4D78-A51B-0C43ADC23805">lib</span><span class="filepath" id="GUID-CF2E658E-9ACE-47A8-8FEE-15593A6A537F">mkl_sequential.</span><span class="filepath" id="GUID-38F5F6CE-E9B9-4508-8245-5ECAE6BAE62D">so</span> (see 
					 <a href="GUID-BD893FFC-2036-4202-8A3E-F2F1C91058D8.htm">High-level Directory Structure</a>). 
				  </p>
 
				</td>
 
			 </tr>
 
			 <tr> 
				<td class="cellrowborder" valign="top" width="30%" headers="d66342e62 "> 
				  <p id="GUID-E8B8E064-5C2C-4A0A-86FF-EAD45A69CA90">There are multiple programs running on a multiple-cpu system, for example, a parallelized program that runs using MPI for communication in which each processor is treated as a node. 
				  </p>
 
				</td>
 
				<td class="row-nocellborder" valign="top" width="70%" headers="d66342e68 "> 
				  <p id="GUID-0BB062C8-8419-4831-B099-CFD29ABEE6A7">The threading software will see multiple processors on the system even though each processor has a separate MPI process running on it. In this case, one of the solutions is to set the number of threads to one by any of the available means (see 
					 <a href="GUID-DEEF0363-2B34-4BAB-87FA-A75DBE842040.htm">Techniques to Set the Number of Threads</a>). 
					 Section 
						<a href="GUID-10DFCB17-3953-47C6-9971-8C455A925BFE.htm">Intel&reg; Optimized MP LINPACK Benchmark for Clusters</a> discusses another solution for a Hybrid (OpenMP* + MPI) mode. 
				  </p>
 
				</td>
 
			 </tr>
 
		  </tbody>
 
		</table>
</div>
 
	 <p>Using the 
  <span class="option">mkl_set_num_threads</span> and 
  <span class="option">mkl_domain_set_num_threads</span> functions to control parallelism of Intel MKL from parallel user threads may result in a race condition that impacts the performance of the application because these functions operate on internal control variables that are global, that is, apply to all threads. For example, if parallel user threads call these functions to set different numbers of threads for the same function domain, the number of threads actually set is unpredictable. To avoid this kind of data races, use the 
  <span class="option">mkl_set_num_threads_local</span> function (see the "Support Functions" 
  section in the 
  <em>Intel MKL Reference Manual</em> for the function description). 
  </p>
 
  <p> 
	 
<div class="tablenoborder"><a name="d20e18"><!-- --></a><table cellpadding="4" summary="" id="d20e18" frame="border" border="1" cellspacing="0" rules="all"> 
		  <thead align="left"> 
			 <tr> 
				<th class="cellrowborder" align="left" valign="top" width="100%" id="d66342e210"> 
				  <p id="d20e29"><a name="d20e29"><!-- --></a>Optimization Notice 
				  </p>
 
				</th>
 
			 </tr>
</thead>
 
		  <tbody> 
			 <tr> 
				<td class="bgcolor(#f5f5f5)" bgcolor="#f5f5f5" valign="top" width="100%" headers="d66342e210 "> 
				  <p>Intel's compilers may or may not optimize to the same degree for non-Intel microprocessors for optimizations that are not unique to Intel microprocessors. These optimizations include SSE2, SSE3, and SSSE3 instruction sets and other optimizations. Intel does not guarantee the availability, functionality, or effectiveness of any optimization on microprocessors not manufactured by Intel. Microprocessor-dependent optimizations in this product are intended for use with Intel microprocessors. Certain optimizations not specific to Intel microarchitecture are reserved for Intel microprocessors. Please refer to the applicable product User and Reference Guides for more information regarding the specific instruction sets covered by this notice. 
				  </p>
 
				  <p> Notice revision #20110804 
				  </p>
  

				  </td>
 
			 </tr>
 
		  </tbody>
 
		</table>
</div>
 
	 </p>
 
  </div>
 
  
<div class="familylinks">
<div class="parentlink"><strong>Parent topic:</strong>&nbsp;<a href="GUID-A09C5398-D263-42F8-95E2-772C3C1FE79C.htm">Improving Performance with Threading</a></div>
</div>
<div class="See Also"><h2>See Also</h2>
<div class="linklist">
<div><a href="GUID-0073DDBD-3239-44B2-AD92-87A533733E11.htm">Using Additional Threading Control 
		  </a>  
		  </div>
<div><a href="GUID-01E66248-FBD1-49E9-8EFF-40AE61A81C57.htm">Linking with Compiler Support RTLs 
		  </a>  
		  </div></div><br clear="all">
<div class="docfeedback">
<div><a href="http://www.intel.com/software/products/softwaredocs_feedback" target="_blank">Submit feedback on this help topic 
		  </a></div></div></div> 

</body>
</html>
